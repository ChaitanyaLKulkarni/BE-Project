const _unicodeToSym = new Map([
    ["2c", "hamcomma"],
    ["2e", "hamfullstop"],
    ["3f", "hamquery"],
    ["7b", "hamaltbegin"],
    ["7c", "hammetaalt"],
    ["7d", "hamaltend"],
    ["20", "hamspace"],
    ["21", "hamexclaim"],
    ["e0a0", "hamcircleui"],
    ["e0a1", "hamcircledo"],
    ["e0a2", "hamcircleuo"],
    ["e0a3", "hamcircledi"],
    ["e0a4", "hamfingerplay"],
    ["e0a5", "hamnodding"],
    ["e0a6", "hamswinging"],
    ["e0a7", "hamtwisting"],
    ["e0a8", "hamstircw"],
    ["e0a9", "hamstirccw"],
    ["e0aa", "hamreplace"],
    ["e0af", "hamnomotion"],
    ["e0b0", "hamclocku"],
    ["e0b1", "hamclockul"],
    ["e0b2", "hamclockl"],
    ["e0b3", "hamclockdl"],
    ["e0b4", "hamclockd"],
    ["e0b5", "hamclockdr"],
    ["e0b6", "hamclockr"],
    ["e0b7", "hamclockur"],
    ["e0b8", "hamclockfull"],
    ["e0b9", "hamarcl"],
    ["e0ba", "hamarcu"],
    ["e0bb", "hamarcr"],
    ["e0bc", "hamarcd"],
    ["e0bd", "hamwavy"],
    ["e0be", "hamzigzag"],
    ["e0c0", "hamellipseh"],
    ["e0c1", "hamellipseur"],
    ["e0c2", "hamellipsev"],
    ["e0c3", "hamellipseul"],
    ["e0c4", "hamincreasing"],
    ["e0c5", "hamdecreasing"],
    ["e0c6", "hamsmallmod"],
    ["e0c7", "hamlargemod"],
    ["e0c8", "hamfast"],
    ["e0c9", "hamslow"],
    ["e0ca", "hamtense"],
    ["e0cb", "hamrest"],
    ["e0cc", "hamhalt"],
    ["e0d0", "hamclose"],
    ["e0d1", "hamtouch"],
    ["e0d2", "haminterlock"],
    ["e0d3", "hamcross"],
    ["e0d4", "hamarmextended"],
    ["e0d5", "hambehind"],
    ["e0d6", "hambrushing"],
    ["e0d8", "hamrepeatfromstart"],
    ["e0d9", "hamrepeatfromstartseveral"],
    ["e0da", "hamrepeatcontinue"],
    ["e0db", "hamrepeatcontinueseveral"],
    ["e0dc", "hamrepeatreverse"],
    ["e0dd", "hamalternatingmotion"],
    ["e0e0", "hamseqbegin"],
    ["e0e1", "hamseqend"],
    ["e0e2", "hamparbegin"],
    ["e0e3", "hamparend"],
    ["e0e4", "hamfusionbegin"],
    ["e0e5", "hamfusionend"],
    ["e0e6", "hambetween"],
    ["e0e7", "hamplus"],
    ["e0e8", "hamsymmpar"],
    ["e0e9 e010 e0c7", "hamsymmlr,hamfingerstraightmod,hamlargemod"],
    ["e0ea", "hamnondominant"],
    ["e0eb", "hamnonipsi"],
    ["e0ec", "hametc"],
    ["e0ed", "hamorirelative"],
    ["e0f0", "hammime"],
    ["e00a", "hamceeall"],
    ["e00b", "hamceeopen"],
    ["e00c", "hamthumboutmod"],
    ["e00d", "hamthumbacrossmod"],
    ["e00e", "hamthumbopenmod"],
    ["e000", "hamfist"],
    ["e001", "hamflathand"],
    ["e002", "hamfinger2"],
    ["e02a", "hamextfingeror"],
    ["e02b", "hamextfingeril"],
    ["e02c", "hamextfingeri"],
    ["e02d", "hamextfingerir"],
    ["e02e", "hamextfingerui"],
    ["e02f", "hamextfingerdi"],
    ["e003", "hamfinger23"],
    ["e03a", "hampalmr"],
    ["e03b", "hampalmdr"],
    ["e03c", "hampalmd"],
    ["e03d", "hampalmdl"],
    ["e03e", "hampalml"],
    ["e03f", "hampalmul"],
    ["e004", "hamfinger23spread"],
    ["e04a", "hamlips"],
    ["e04b", "hamtongue"],
    ["e04c", "hamteeth"],
    ["e04d", "hamchin"],
    ["e04e", "hamunderchin"],
    ["e04f", "hamneck"],
    ["e005", "hamfinger2345"],
    ["e05a", "hamcoreftag"],
    ["e05b", "hamcorefref"],
    ["e05f", "hamneutralspace"],
    ["e006", "hampinch12"],
    ["e06a", "hampinkyside"],
    ["e007", "hampinchall"],
    ["e07a", "hamfingerside"],
    ["e008", "hampinch12open"],
    ["e08a", "hammoveor"],
    ["e08b", "hammoveil"],
    ["e08c", "hammovei"],
    ["e08d", "hammoveir"],
    ["e08e", "hammoveui"],
    ["e08f", "hammovedi"],
    ["e009", "hamcee12"],
    ["e09a", "hamcircleur"],
    ["e09b", "hamcircledl"],
    ["e09c", "hamcircleol"],
    ["e09d", "hamcircleir"],
    ["e09e", "hamcircleor"],
    ["e09f", "hamcircleil"],
    ["e010", "hamfingerstraightmod"],
    ["e011", "hamfingerbendmod"],
    ["e012", "hamfingerhookmod"],
    ["e013", "hamdoublebent"],
    ["e014", "hamdoublehooked"],
    ["e020", "hamextfingeru"],
    ["e021", "hamextfingerur"],
    ["e022", "hamextfingerr"],
    ["e023", "hamextfingerdr"],
    ["e024", "hamextfingerd"],
    ["e025", "hamextfingerdl"],
    ["e026", "hamextfingerl"],
    ["e027", "hamextfingerul"],
    ["e028", "hamextfingerol"],
    ["e029", "hamextfingero"],
    ["e030", "hamextfingerdo"],
    ["e031", "hamextfingeruo"],
    ["e038", "hampalmu"],
    ["e039", "hampalmur"],
    ["e040", "hamhead"],
    ["e041", "hamheadtop"],
    ["e042", "hamforehead"],
    ["e043", "hameyebrows"],
    ["e044", "hameyes"],
    ["e045", "hamnose"],
    ["e046", "hamnostrils"],
    ["e047", "hamear"],
    ["e048", "hamearlobe"],
    ["e049", "hamcheek"],
    ["e050", "hamshouldertop"],
    ["e051", "hamshoulders"],
    ["e052", "hamchest"],
    ["e053", "hamstomach"],
    ["e054", "hambelowstomach"],
    ["e058", "hamlrbeside"],
    ["e059", "hamlrat"],
    ["e060", "hamupperarm"],
    ["e062", "hamelbowinside"],
    ["e063", "hamlowerarm"],
    ["e064", "hamwristback"],
    ["e066", "hamthumbball"],
    ["e067", "hampalm"],
    ["e068", "hamhandback"],
    ["e069", "hamthumbside"],
    ["e070", "hamthumb"],
    ["e071", "hamindexfinger"],
    ["e072", "hammiddlefinger"],
    ["e073", "hamringfinger"],
    ["e074", "hampinky"],
    ["e075", "hamfingertip"],
    ["e076", "hamfingernail"],
    ["e077", "hamfingerpad"],
    ["e078", "hamfingermidjoint"],
    ["e079", "hamfingerbase"],
    ["e080", "hammoveu"],
    ["e081", "hammoveur"],
    ["e082", "hammover"],
    ["e083", "hammovedr"],
    ["e084", "hammoved"],
    ["e085", "hammovedl"],
    ["e086", "hammovel"],
    ["e087", "hammoveul"],
    ["e088", "hammoveol"],
    ["e089", "hammoveo"],
    ["e090", "hammovedo"],
    ["e091", "hammoveuo"],
    ["e092", "hamcircleo"],
    ["e093", "hamcirclei"],
    ["e094", "hamcircled"],
    ["e095", "hamcircleu"],
    ["e096", "hamcirclel"],
    ["e097", "hamcircler"],
    ["e098", "hamcircleul"],
    ["e099", "hamcircledr"],
]);
const _symToUnicode = new Map([
    ["hamaltbegin", "7b"],
    ["hamaltend", "7d"],
    ["hamalternatingmotion", "e0dd"],
    ["hamarcd", "e0bc"],
    ["hamarcl", "e0b9"],
    ["hamarcr", "e0bb"],
    ["hamarcu", "e0ba"],
    ["hamarmextended", "e0d4"],
    ["hambehind", "e0d5"],
    ["hambelowstomach", "e054"],
    ["hambetween", "e0e6"],
    ["hambrushing", "e0d6"],
    ["hamcee12", "e009"],
    ["hamceeall", "e00a"],
    ["hamceeopen", "e00b"],
    ["hamcheek", "e049"],
    ["hamchest", "e052"],
    ["hamchin", "e04d"],
    ["hamcircled", "e094"],
    ["hamcircledi", "e0a3"],
    ["hamcircledl", "e09b"],
    ["hamcircledo", "e0a1"],
    ["hamcircledr", "e099"],
    ["hamcirclei", "e093"],
    ["hamcircleil", "e09f"],
    ["hamcircleir", "e09d"],
    ["hamcirclel", "e096"],
    ["hamcircleo", "e092"],
    ["hamcircleol", "e09c"],
    ["hamcircleor", "e09e"],
    ["hamcircler", "e097"],
    ["hamcircleu", "e095"],
    ["hamcircleui", "e0a0"],
    ["hamcircleul", "e098"],
    ["hamcircleuo", "e0a2"],
    ["hamcircleur", "e09a"],
    ["hamclockd", "e0b4"],
    ["hamclockdl", "e0b3"],
    ["hamclockdr", "e0b5"],
    ["hamclockfull", "e0b8"],
    ["hamclockl", "e0b2"],
    ["hamclockr", "e0b6"],
    ["hamclocku", "e0b0"],
    ["hamclockul", "e0b1"],
    ["hamclockur", "e0b7"],
    ["hamclose", "e0d0"],
    ["hamcomma", "2c"],
    ["hamcorefref", "e05b"],
    ["hamcoreftag", "e05a"],
    ["hamcross", "e0d3"],
    ["hamdecreasing", "e0c5"],
    ["hamdoublebent", "e013"],
    ["hamdoublehooked", "e014"],
    ["hamear", "e047"],
    ["hamearlobe", "e048"],
    ["hamelbowinside", "e062"],
    ["hamellipseh", "e0c0"],
    ["hamellipseul", "e0c3"],
    ["hamellipseur", "e0c1"],
    ["hamellipsev", "e0c2"],
    ["hametc", "e0ec"],
    ["hamexclaim", "21"],
    ["hamextfingerd", "e024"],
    ["hamextfingerdi", "e02f"],
    ["hamextfingerdl", "e025"],
    ["hamextfingerdo", "e030"],
    ["hamextfingerdr", "e023"],
    ["hamextfingeri", "e02c"],
    ["hamextfingeril", "e02b"],
    ["hamextfingerir", "e02d"],
    ["hamextfingerl", "e026"],
    ["hamextfingero", "e029"],
    ["hamextfingerol", "e028"],
    ["hamextfingeror", "e02a"],
    ["hamextfingerr", "e022"],
    ["hamextfingeru", "e020"],
    ["hamextfingerui", "e02e"],
    ["hamextfingerul", "e027"],
    ["hamextfingeruo", "e031"],
    ["hamextfingerur", "e021"],
    ["hameyebrows", "e043"],
    ["hameyes", "e044"],
    ["hamfast", "e0c8"],
    ["hamfinger2", "e002"],
    ["hamfinger23", "e003"],
    ["hamfinger23spread", "e004"],
    ["hamfinger2345", "e005"],
    ["hamfingerbase", "e079"],
    ["hamfingerbendmod", "e011"],
    ["hamfingerhookmod", "e012"],
    ["hamfingermidjoint", "e078"],
    ["hamfingernail", "e076"],
    ["hamfingerpad", "e077"],
    ["hamfingerplay", "e0a4"],
    ["hamfingerside", "e07a"],
    ["hamfingerstraightmod", "e010"],
    ["hamfingertip", "e075"],
    ["hamfist", "e000"],
    ["hamflathand", "e001"],
    ["hamforehead", "e042"],
    ["hamfullstop", "2e"],
    ["hamfusionbegin", "e0e4"],
    ["hamfusionend", "e0e5"],
    ["hamhalt", "e0cc"],
    ["hamhandback", "e068"],
    ["hamhead", "e040"],
    ["hamheadtop", "e041"],
    ["hamincreasing", "e0c4"],
    ["hamindexfinger", "e071"],
    ["haminterlock", "e0d2"],
    ["hamlargemod", "e0c7"],
    ["hamlips", "e04a"],
    ["hamlowerarm", "e063"],
    ["hamlrat", "e059"],
    ["hamlrbeside", "e058"],
    ["hammetaalt", "7c"],
    ["hammiddlefinger", "e072"],
    ["hammime", "e0f0"],
    ["hammoved", "e084"],
    ["hammovedi", "e08f"],
    ["hammovedl", "e085"],
    ["hammovedo", "e090"],
    ["hammovedr", "e083"],
    ["hammovei", "e08c"],
    ["hammoveil", "e08b"],
    ["hammoveir", "e08d"],
    ["hammovel", "e086"],
    ["hammoveo", "e089"],
    ["hammoveol", "e088"],
    ["hammoveor", "e08a"],
    ["hammover", "e082"],
    ["hammoveu", "e080"],
    ["hammoveui", "e08e"],
    ["hammoveul", "e087"],
    ["hammoveuo", "e091"],
    ["hammoveur", "e081"],
    ["hamneck", "e04f"],
    ["hamneutralspace", "e05f"],
    ["hamnodding", "e0a5"],
    ["hamnomotion", "e0af"],
    ["hamnondominant", "e0ea"],
    ["hamnonipsi", "e0eb"],
    ["hamnose", "e045"],
    ["hamnostrils", "e046"],
    ["hamorirelative", "e0ed"],
    ["hampalm", "e067"],
    ["hampalmd", "e03c"],
    ["hampalmdl", "e03d"],
    ["hampalmdr", "e03b"],
    ["hampalml", "e03e"],
    ["hampalmr", "e03a"],
    ["hampalmu", "e038"],
    ["hampalmul", "e03f"],
    ["hampalmur", "e039"],
    ["hamparbegin", "e0e2"],
    ["hamparend", "e0e3"],
    ["hampinch12", "e006"],
    ["hampinch12open", "e008"],
    ["hampinchall", "e007"],
    ["hampinky", "e074"],
    ["hampinkyside", "e06a"],
    ["hamplus", "e0e7"],
    ["hamquery", "3f"],
    ["hamrepeatcontinue", "e0da"],
    ["hamrepeatcontinueseveral", "e0db"],
    ["hamrepeatfromstart", "e0d8"],
    ["hamrepeatfromstartseveral", "e0d9"],
    ["hamrepeatreverse", "e0dc"],
    ["hamreplace", "e0aa"],
    ["hamrest", "e0cb"],
    ["hamringfinger", "e073"],
    ["hamseqbegin", "e0e0"],
    ["hamseqend", "e0e1"],
    ["hamshoulders", "e051"],
    ["hamshouldertop", "e050"],
    ["hamslow", "e0c9"],
    ["hamsmallmod", "e0c6"],
    ["hamspace", "20"],
    ["hamstirccw", "e0a9"],
    ["hamstircw", "e0a8"],
    ["hamstomach", "e053"],
    ["hamswinging", "e0a6"],
    ["hamsymmlr", "e0e9"],
    ["hamsymmlr,hamfingerstraightmod,hamlargemod", "e0e9 e010 e0c7"],
    ["hamsymmpar", "e0e8"],
    ["hamteeth", "e04c"],
    ["hamtense", "e0ca"],
    ["hamthumb", "e070"],
    ["hamthumbacrossmod", "e00d"],
    ["hamthumbball", "e066"],
    ["hamthumbopenmod", "e00e"],
    ["hamthumboutmod", "e00c"],
    ["hamthumbside", "e069"],
    ["hamtongue", "e04b"],
    ["hamtouch", "e0d1"],
    ["hamtwisting", "e0a7"],
    ["hamunderchin", "e04e"],
    ["hamupperarm", "e060"],
    ["hamwavy", "e0bd"],
    ["hamwristback", "e064"],
    ["hamzigzag", "e0be"],
]);

function convertToSigml(gloss: string, hamSymbols: string): string {
    let sigmlText = `<sigml>\n\t<hns_sign gloss="${gloss}">\n\t\t<hamnosys_manual>\n`;
    for (const sys of hamSymbols.split(", ")) {
        const s = sys.trim();
        if (!s || !_symToUnicode.get(s)) continue;
        sigmlText += `\t\t\t<${sys}/>\n`;
    }
    sigmlText += "\t\t</hamnosys_manual>\n\t</hns_sign>\n</sigml>";
    return sigmlText;
}

function hamToUnicode(ham: string): string | undefined {
    return _symToUnicode.get(ham);
}
function unicodeToHam(unicode: string): string | undefined {
    return _unicodeToSym.get(unicode);
}

function getHamAndUnicode(
    ham: string,
    s: string
): { unicode: string; ham: string } {
    let hamSym = "";
    let hamUnicode = "";
    for (const sym of ham.match(/<([^(/\)]*)\/>/g) ?? []) {
        const symbol = sym.replace(/<|\/>/g, "");
        const unicode = _symToUnicode.get(symbol);
        if (unicode) {
            hamUnicode += unicode + " ";
            hamSym += symbol + " ";
        } else {
            throw new Error(`${s} -> ${symbol} not found`);
        }
    }
    return { unicode: hamUnicode.trim(), ham: hamSym.trim() };
}

export { unicodeToHam, convertToSigml, hamToUnicode, getHamAndUnicode };
