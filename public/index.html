<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <title>SiGML Play test</title>

        <link rel="stylesheet" href="jas/loc2022/cwa/cwasa.css" />
        <script type="text/javascript" src="jas/loc2022/cwa/allcsa.js"></script>
        <script language="javascript">
            // Initial configuration
            var initCfg = {
                avsbsl: ["luna", "siggi", "anna", "marc", "francoise"],
                avSettings: { avList: "avsbsl", initAv: "luna" },
            };
        </script>
        <style>
            .container {
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                padding: 15px;
                display: flex;
            }
            .controlls {
                width: 60%;
            }
            .avatarContainer {
                width: 80%;
                height: 80%;
            }
            .textContainer {
                margin: 1rem;
            }
            .symbol {
                font-size: 2rem;
                margin-top: 5rem;
                margin-right: 1rem;
            }
            .highlight {
                background-color: #ff0;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="controlls">
                <span class="CWASAAvMenu av0"></span>
                <input
                    type="button"
                    value="Play SiGML Text"
                    class="bttnPlaySiGMLText av0"
                    style="display: none"
                />
                <!-- <span class="CWASASpeed av0"></span> -->
                <br />
                <input
                    type="text"
                    id="URLText"
                    class="txtaSiGMLText av0"
                    value=""
                    style="display: none"
                />
                <textarea
                    name=""
                    id="textInp"
                    cols="30"
                    rows="5"
                    placeholder="Enter text"
                ></textarea>
                <button onclick="stemAndPlay();">Play</button>
                <input type="button" value="Stop" class="bttnStop av0" />
                <br />
            </div>
            <div class="avatarContainer">
                <div class="CWASAAvatar av0" align="center"></div>
                <div class="textContainer"></div>
            </div>
        </div>
        <script>
            CWASA.init(initCfg);
            const textContainer = document.querySelector(".textContainer");
            const textInp = document.getElementById("textInp");
            const SiGMLTextElement = document.querySelector(".txtaSiGMLText");
            const bttnPlaySiGMLTextElement =
                document.querySelector(".bttnPlaySiGMLText");

            function stemAndPlay() {
                const text = textInp.value;
                fetch(
                    "/api/sign?" + new URLSearchParams({ q: text }).toString()
                )
                    .then((res) => res.json())
                    .then((data) => {
                        console.log(data);
                        textContainer.innerHTML = "";
                        let currId = 0;
                        for (const symbol of data.symbols) {
                            if (Array.isArray(symbol)) {
                                const parent = document.createElement("span");
                                parent.classList.add("symbol");
                                for (letter of symbol) {
                                    const span = document.createElement("span");
                                    span.innerText = letter;
                                    span.setAttribute("id", `symbol-${currId}`);
                                    parent.appendChild(span);
                                    currId++;
                                }
                                textContainer.appendChild(parent);
                            } else {
                                const span = document.createElement("span");
                                span.innerText = symbol;
                                span.classList.add("symbol");
                                span.setAttribute("id", `symbol-${currId}`);
                                textContainer.appendChild(span);
                                currId++;
                            }
                        }

                        SiGMLTextElement.value = data.sigml;
                        bttnPlaySiGMLTextElement.click();
                    });
            }
            CWASA.addHook("avatarsign", (e) => {
                // {typ: "avatarsign", msg: {g: 'your', f: 1, s: 0}, av: 0}
                document
                    .querySelector(`#symbol-${e.msg.s}`)
                    .classList.toggle("highlight", true);
                if (e.msg.s > 0) {
                    document
                        .querySelector(`#symbol-${e.msg.s - 1}`)
                        .classList.toggle("highlight", false);
                }
            });
            // Output
        </script>
    </body>
</html>
<!-- 
    <body onload="CWASA.init(initCfg);">
        <script language="javascript">
            function playText(stext) {
                CWASA.playSiGMLText(stext);
            }

            function setSiGMLURL(sigmlURL) {
                var loc = window.location.href;
                var locDir = loc.substring(0, loc.lastIndexOf("/"));
                // console.log("SiGML: "+sigmlURL);
                // console.log("Location Dir: "+locDir);
                sigmlURL = locDir + "/" + sigmlURL;
                document.getElementById("URLText").value = sigmlURL;
                return sigmlURL;
            }

            function startPlayer(sigmlURL) {
                console.log("Start player: " + sigmlURL);
                sigmlURL = setSiGMLURL(sigmlURL);
                // Equivalent to click on Sign button
                CWASA.playSiGMLURL(sigmlURL);
            }
        </script>

        <div
            style="
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                padding: 15px;
            "
        >
            <table align="center" style="width: 60%; height: 100%">
                <tr align="center">
                    <td width="100%" height="100%">
                        
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        
                        <script language="javascript">
                            // Set default sign
                            setSiGMLURL("SignFiles/yourhobbieswhat.sigml");
                        </script>
                    </td>
                </tr>
            </table>
        </div>
    </body>
</html> -->
