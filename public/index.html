<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <title>SiGML Play test</title>

        <link rel="stylesheet" href="jas/loc2022/cwa/cwasa.css" />
        <script type="text/javascript" src="jas/loc2022/cwa/allcsa.js"></script>
        <script language="javascript">
            // Initial configuration
            var initCfg = {
                avsbsl: ["anna", "francoise", "luna", "marc", "siggi" ],
                avSettings: { avList: "avsbsl", initAv: "luna" },
            };
        </script>
        <style>
            .container {
                margin-left: 20px;
                margin-right: 20px;
                box-sizing: border-box;
                width: 96%;
                height: 100%;
                padding: 15px;
                display: flex;
                align-content: center;
            }
            .controlls {
                align-content: center;
                width: 40%;
                margin-left: 20px;
                margin-right: 20px;
                margin-top: 0px;
            }
            .avatarContainer {
                width: 60%;
                height: 80%;
            }
            .textContainer {
                margin-top: 1rem;
                font-size: 20px;
                padding: 5px;
                width: 99%;
                text-align: center;
                background-color: #90B1D6;
                font-weight: bold;
            }
            .symbol {
                font-size: 2rem;
                margin-top: 5rem;
                margin-right: 1rem;
            }
            .highlight {
                background-color: #ff0;
            }
            button,input[type=button]{
                color: white;
                width: 200px;
                height: 35px;
                border-radius: 10px;
                border: none;
                font-size: 20px;

            }
            button:hover {
                background-color:  #8BFE7A;
            }

           input[type=button]:hover {
                background-color: #FE8D7C;
            }
            .play{
                background-color: #4CAF50;
            }
            .stop{
                background-color: #FF2300;
            }
            .heading{
                padding: 5px;
                height: 35px;
                width: 100%;
                background-color: #90B1D6;
                font-size: 30px;
                font-weight: bold;
            }
            textarea, .CWASAAvMenu .av0{
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: inline-block;
                border: 1px solid #ccc;
                border-radius: 7px;
                box-sizing: border-box;
                font-size: 18px;
            }
            label{
                font-size: 20px;
                font-weight: bold;
            }
        </style>
    </head>

    <body>
        <div class="container">  
            <div class="controlls">
                <center><p class="heading">Text to ISL Converter</center> </p>
                <input
                    type="button"
                    value="Play SiGML Text"
                    class="bttnPlaySiGMLText av0"
                    style="display: none"
                />
                <!-- <span class="CWASASpeed av0"></span> -->
                <!-- <input type="button" value="Suspend" class="bttnSuspend av0" disabled="">
                <input type="button" value="Resume" class="bttnResume av0" disabled="">
                Frames:
                <input type="button" value="-1" class="bttnPrevF av0" disabled="">
                <input type="button" value="+1" class="bttnNextF av0" disabled="">
                </span> -->
                <label for="menu">Select the Avatar: &emsp;</label>
                <span class="CWASAAvMenu av0" id="menu"></span>
                <br><br><br>
                <label for="textInp">Enter the Text: &emsp;</label>
                <textarea 
                    name=""
                    id="textInp"
                    cols="30"
                    rows="5"
                    placeholder="Enter text"
                ></textarea><br><br><br>
                <input type="text"
                    id="URLText"
                    class="txtaSiGMLText av0"
                    value=""
                    style="display: none"
                />
                
                <center><button class="play" onclick="stemAndPlay();">Play</button>&emsp;
                <input class="stop" type="button" value="Stop" class="bttnStop av0" /></center>
                <br />
                
                
                <br>
            </div>
            <div class="avatarContainer">
                <div class="CWASAAvatar av0" align="center"></div>
                <div class="textContainer"></div>
            </div>
        </div>
        <script>
            CWASA.init(initCfg);
            const textContainer = document.querySelector(".textContainer");
            const textInp = document.getElementById("textInp");
            const SiGMLTextElement = document.querySelector(".txtaSiGMLText");
            const bttnPlaySiGMLTextElement =
                document.querySelector(".bttnPlaySiGMLText");

            function stemAndPlay() {
                const text = textInp.value;
                fetch(
                    "/api/sign?" + new URLSearchParams({ q: text }).toString()
                )
                    .then((res) => res.json())
                    .then((data) => {
                        console.log(data);
                        textContainer.innerHTML = "";
                        let currId = 0;
                        for (const symbol of data.symbols) {
                            if (Array.isArray(symbol)) {
                                const parent = document.createElement("span");
                                parent.classList.add("symbol");
                                for (letter of symbol) {
                                    const span = document.createElement("span");
                                    span.innerText = letter;
                                    span.setAttribute("id", `symbol-${currId}`);
                                    parent.appendChild(span);
                                    currId++;
                                }
                                textContainer.appendChild(parent);
                            } else {
                                const span = document.createElement("span");
                                span.innerText = symbol;
                                span.classList.add("symbol");
                                span.setAttribute("id", `symbol-${currId}`);
                                textContainer.appendChild(span);
                                currId++;
                            }
                        }

                        SiGMLTextElement.value = data.sigml;
                        bttnPlaySiGMLTextElement.click();
                    });
            }
            CWASA.addHook("avatarsign", (e) => {
                // {typ: "avatarsign", msg: {g: 'your', f: 1, s: 0}, av: 0}
                document
                    .querySelector(`#symbol-${e.msg.s}`)
                    .classList.toggle("highlight", true);
                if (e.msg.s > 0) {
                    document
                        .querySelector(`#symbol-${e.msg.s - 1}`)
                        .classList.toggle("highlight", false);
                }
            });
            // Output
        </script>
    </body>
</html>